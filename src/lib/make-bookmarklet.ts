export type MakeBookmarkletArgs = {
	speed: number;
	fixedSpeed: boolean;
	allMedia: boolean;
	includeAudio: boolean;
};

// See `bookmarklet.ts`.
// Minified with esbuild:
// https://esbuild.github.io/try/#YgAwLjI1LjkALS1idW5kbGUKLS1mb3JtYXQ9ZXNtCi0tb3V0ZmlsZT1vdXQuanMKLS1taW5pZnkAZQBlbnRyeS50cwAvKgpUaGlzIGlzIHRoZSBib29rbWFya2xldCBmdW5jdGlvbiB1c2VkIGluIHNwZWVkIGNvbnRyb2xzIGJlZm9yZSBtaW5pZmljYXRpb24uCgpAcGFyYW0gc3BlZWQgLSBEZXNpcmVkIHBsYXliYWNrIHNwZWVkLCBmb3IgZXhhbXBsZSAzeC4KQHBhcmFtIGZpeGVkU3BlZWQgLSBJZiB0cnVlLCBqdXN0IHNldCB0aGUgc3BlZWQgYW5kIG5ldmVyIHJlc2V0IHRvIDF4LgpAcGFyYW0gYWxsTWVkaWEgLSBJZiB0cnVlLCBzZWxlY3QgYWxsIG1lZGlhIGVsZW1lbnRzIGluIGEgcGFnZS4KQHBhcmFtIGluY2x1ZGVBdWRpbyAtIElmIHRydWUsIHNlbGVjdCBhbHNvIGF1ZGlvIGVsZW1lbnRzIGluIGEgcGFnZS4KKi8KZXhwb3J0IGxldCBib29rbWFya2xldCA9ICgKCXNwZWVkOiBudW1iZXIsCglmaXhlZFNwZWVkOiBib29sZWFuLAoJYWxsTWVkaWE6IGJvb2xlYW4sCglpbmNsdWRlQXVkaW86IGJvb2xlYW4KKSA9PiB7CgkvLyBTaG9ydGVuIHN1Y2Nlc3NpdmUgY2FsbHMgdG8gYGRvY3VtZW50YCBhbmQgYHdpbmRvd2AuCglsZXQgZCA9IGRvY3VtZW50OwoKCS8vIEFkZCB0aGUgZm9sbG93aW5nIFZpZGVvU3BlZWR1cCAodnMpIHByb3BlcnRpZXMgdG8gYHdpbmRvd2A6CgkvLyAxLiBfX3ZzczogdGhlIHdhbnRlZCBwbGF5YmFjayBzcGVlZCAoZm9yIGV4YW1wbGUsIDN4KS4KCS8vIDIuIF9fdnNvOiBhIE11dGF0aW9uT2JzZXJ2ZXIgdGhhdCBjaGVja3MgYW5kIHJlYWN0cyB0byBwYWdlIHVwZGF0ZXMuCgkvLyAzLiBfX3ZzYTogYSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIHdoZXRoZXIgdGhlIE11dGF0aW9uT2JzZXJ2ZXIgaXMgYWN0aXZlIG9yIG5vdC4KCWxldCB3ID0gd2luZG93IGFzIFdpbmRvdyAmCgkJdHlwZW9mIGdsb2JhbFRoaXMgJiB7IF9fdnNzOiBudW1iZXI7IF9fdnNvOiBNdXRhdGlvbk9ic2VydmVyOyBfX3ZzYTogYm9vbGVhbiB9OwoKCS8vIEZ1bmN0aW9uIHVzZWQgdG8gY2hhbmdlIHRoZSBwbGF5YmFjayBzcGVlZCBvZiBtZWRpYSBlbGVtZW50cy4KCWxldCBjaGFuZ2VQbGF5YmFja1NwZWVkID0gKG9ic2VydmluZz86IGJvb2xlYW4pID0+IHsKCQkvLyAxLiBTZWxlY3QgYWxsIG1lZGlhIGVsZW1lbnRzIG9uIHRoZSBwYWdlOwoJCS8vICAgIG9ubHkgYHZpZGVvYCBieSBkZWZhdWx0OyBhbHNvIGBhdWRpb2AgaWYgc2VsZWN0ZWQuCgkJLy8gMi4gS2VlcCBvbmx5IHJlbGV2YW50IG1lZGlhIGVsZW1lbnRzOwoJCS8vICAgIG9ubHkgZmlyc3QgdmlkZW8vYXVkaW8gZWxlbWVudCBieSBkZWZhdWx0OyBhbGwgZWxlbWVudHMgaWYgc2VsZWN0ZWQuCgkJLy8gMy4gQ2hhbmdlIHBsYXliYWNrIHNwZWVkIG9mIHRhcmdldCBlbGVtZW50czsKCQkvLyAgICBhbHRlcm5hdGUgYmV0d2VlbiB0aGUgd2FudGVkIHBsYXliYWNrIHNwZWVkIGFuZCB0aGUgZGVmYXVsdCAxeCBzcGVlZCBieSBkZWZhdWx0OwoJCS8vICAgIG9yIGp1c3Qgc2V0IHRoZSB3YW50ZWQgc3BlZWQgaWYgc2VsZWN0ZWQgb3IgaWYgd2UgYXJlIG9ic2VydmluZyBhIHBhZ2UgdXBkYXRlLgoJCVsuLi5kLnF1ZXJ5U2VsZWN0b3JBbGwoaW5jbHVkZUF1ZGlvID8gJ3ZpZGVvLGF1ZGlvJyA6ICd2aWRlbycpXQoJCQkuc2xpY2UoMCwgYWxsTWVkaWEgPyB1bmRlZmluZWQgOiAxKQoJCQkuZm9yRWFjaCgodGFyZ2V0KSA9PiB7CgkJCQlpZiAoZml4ZWRTcGVlZCB8fCBvYnNlcnZpbmcpIHsKCQkJCQkodGFyZ2V0IGFzIEhUTUxNZWRpYUVsZW1lbnQpLnBsYXliYWNrUmF0ZSA9IHcuX192c3M7CgkJCQl9IGVsc2UgewoJCQkJCSh0YXJnZXQgYXMgSFRNTE1lZGlhRWxlbWVudCkucGxheWJhY2tSYXRlID0KCQkJCQkJKHRhcmdldCBhcyBIVE1MTWVkaWFFbGVtZW50KS5wbGF5YmFja1JhdGUgIT09IHcuX192c3MgPyB3Ll9fdnNzIDogMTsKCQkJCX0KCQkJfSk7Cgl9OwoKCS8vIEZ1bmN0aW9uIHRoYXQgdHJhY2tzIERPTSBjaGFuZ2VzIHRvIG1ha2Ugc3VyZSB0aGF0IGFsbCBtZWRpYSBlbGVtZW50cwoJLy8gYWRkZWQgZHluYW1pY2FsbHkgdG8gYSBwYWdlIGFyZSBhZmZlY3RlZCBieSBzcGVlZCBjaGFuZ2VzLgoJLy8gVGhpcyBpcyBuZWVkZWQgZm9yIGR5bmFtaWMgcGFnZXMgbGlrZSBZb3VUdWJlIFNob3J0cyBvciBUd2l0dGVyIGZlZWQuCglsZXQgb2JzZXJ2ZUNoYW5nZXMgPSAoKSA9PiB7CgkJaWYgKCFhbGxNZWRpYSkgcmV0dXJuOwoKCQkvLyBJZiBpdCBkb2VzIG5vdCBleGlzdCwgY3JlYXRlIGEgTXV0YXRpb25PYnNlcnZlciB0aGF0IGNoZWNrcyBmb3IgcGFnZSB1cGRhdGVzCgkJLy8gYW5kIHNldHMgdGhlIHNwZWVkIHRvIHRoZSB3YW50ZWQgb25lIHdoZW4gdXBkYXRlcyBhcmUgb2JzZXJ2ZWQuCgkJdy5fX3ZzbyA9CgkJCXcuX192c28gfHwKCQkJbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKCkgPT4gewoJCQkJY2hhbmdlUGxheWJhY2tTcGVlZCh0cnVlKTsKCQkJfSk7CgkJdy5fX3ZzYSA9IHcuX192c2EgfHwgZmFsc2U7CgoJCWlmICghdy5fX3ZzYSkgewoJCQkvLyBJZiBub3Qgb2JzZXJ2aW5nLCBzdGFydCBvYnNlcnZpbmcgdGhlIGVudGlyZSBgYm9keWAgdHJlZS4KCQkJbGV0IGJvZHkgPSBkLnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKSBhcyBIVE1MQm9keUVsZW1lbnQ7CgkJCXcuX192c28ub2JzZXJ2ZShib2R5LCB7IHN1YnRyZWU6IHRydWUsIGNoaWxkTGlzdDogdHJ1ZSB9KTsKCQkJdy5fX3ZzYSA9IHRydWU7CgkJCXJldHVybjsKCQl9CgoJCWlmICh3Ll9fdnNhICYmIHcuX192c3MgPT09IHNwZWVkKSB7CgkJCS8vIElmIG9ic2VydmluZyBhbmQgd2FudGVkIHNwZWVkIGhhcyBub3QgY2hhbmdlZCwgdGhhdCBpcywKCQkJLy8gaWYgdGhlIG1vc3QgcmVjZW50bHkgY2xpY2tlZCBib29rbWFya2xldCBnb3QgY2xpY2tlZCBhZ2Fpbiwgc3RvcCBvYnNlcnZpbmcuCgkJCS8vIFRoZSBzcGVlZCBjaGVjayBwcmV2ZW50cyBkZWFjdGl2YXRpbmcgdGhlIG9ic2VydmVyIHdoZW4gdGhlIHVzZXIgY2xpY2tzCgkJCS8vIGRpZmZlcmVudCBib29rbWFya2xldHMgdG8gc2V0IGRpZmZlcmVudCBzcGVlZHMuCgkJCXcuX192c28uZGlzY29ubmVjdCgpOwoJCQl3Ll9fdnNhID0gZmFsc2U7CgkJCXJldHVybjsKCQl9Cgl9OwoKCS8vIE9ic2VydmUgcGFnZSBmb3IgY2hhbmdlcy4KCW9ic2VydmVDaGFuZ2VzKCk7CgoJLy8gU2V0IHRoZSB3YW50ZWQgcGxheWJhY2sgc3BlZWQgd2hlbiB0aGUgYm9va21hcmtsZXQgaXMgY2xpY2tlZC4KCS8vIE11c3QgY29tZSBhZnRlciBgb2JzZXJ2ZUNoYW5nZXMoKWAgY2FsbCB0byBwcmV2ZW50IHRoZSBgdy5fX3ZzcyA9PT0gc3BlZWRgIGNoZWNrIHRvIGFsd2F5cyBiZSBgdHJ1ZWAuCgl3Ll9fdnNzID0gc3BlZWQ7CgoJLy8gVHJpZ2dlciBhdCBsZWFzdCBvbmUgc3BlZWQgY2hhbmdlLgoJY2hhbmdlUGxheWJhY2tTcGVlZCgpOwp9Owo
const bookmarkletMin = `(o,n,_,r)=>{let l=document,e=window,t=s=>{[...l.querySelectorAll(r?"video,audio":"video")].slice(0,_?void 0:1).forEach(a=>{n||s?a.playbackRate=e.__vss:a.playbackRate=a.playbackRate!==e.__vss?e.__vss:1})};(()=>{if(_){if(e.__vso=e.__vso||new MutationObserver(()=>{t(!0)}),e.__vsa=e.__vsa||!1,!e.__vsa){let s=l.querySelector("body");e.__vso.observe(s,{subtree:!0,childList:!0}),e.__vsa=!0;return}if(e.__vsa&&e.__vss===o){e.__vso.disconnect(),e.__vsa=!1;return}}})(),e.__vss=o,t()}`;

const shortBool = (b: boolean) => (b ? '!0' : '!1');

export const makeBookmarklet = ({
	speed,
	fixedSpeed,
	allMedia,
	includeAudio
}: MakeBookmarkletArgs) => {
	const args = [speed, shortBool(fixedSpeed), shortBool(allMedia), shortBool(includeAudio)].join(
		','
	);
	return `javascript:(${bookmarkletMin})(${args});`;
};
